<html>
    
    <head>
        <link rel="stylesheet" type="text/css" href="../../css/adapter.css" />
        <link rel="stylesheet" type="text/css" href="../../lib/css/materialize.css">
    
        <script type="text/javascript" src="../../lib/js/jquery-3.2.1.min.js"></script>
        <script type="text/javascript" src="../../socket.io/socket.io.js"></script>
    
        <script type="text/javascript" src="../../js/translate.js"></script>
        <script type="text/javascript" src="../../lib/js/materialize.js"></script>
        <script type="text/javascript" src="../../js/adapter-settings.js"></script>
        <script type="text/javascript" src="words.js"></script>
    
        <script type="text/javascript">
    
        var groups = [];

            function setValue(id, value, onChange) {
                var $value = $('#' + id + '.value');
    
                if ($value.attr('type') === 'checkbox') {
                    $value.prop('checked', value).change(function () {
                        onChange();
                    });
                } else {
                    $value.val(value).on('change', function () {
                        onChange();
                    }).on('keyup', function () {
                        onChange();
                    });
                }
            }
    
            // the function loadSettings has to exist ...
            function load(settings, onChange) {
                if (!settings) return;
                groups = settings.groups || [];
    
                for (var key in settings) {
                    if (!settings.hasOwnProperty(key)) continue;
                    setValue(key, settings[key], onChange);
                }
                values2table('values', groups, onChange);
    
                // Signal to admin, that no changes yet
                onChange(false);
    
            }
            // ... and the function save has to exist.
            // you have to make sure the callback is called with the settings object as first param!
            function save(callback) {
                // example: select elements with class=value and build settings object
                var obj = {};
                $('.value').each(function () {
                    var $this = $(this);
                    if ($this.attr('type') === 'checkbox') {
                        obj[$this.attr('id')] = $this.prop('checked');
                    } else {
                        obj[$this.attr('id')] = $this.val();
                    }
                });
                // Get edited table
                obj.groups = table2values('values');
                callback(obj);
            }
    
        </script>
        <style>
            .sub-title {
                margin-top: 2rem!important;
                padding: 0.5rem;
                background: #64b5f6;
                color: white;
            }
        </style>
    </head>
    
    <body>
        <!-- you have to put your config page in a div with id adapter-container -->
        <div class="m adapter-container">

            <div class="row">
                <div class="col s12">
                    <ul class="tabs">
                        <li class="tab col s2"><a href="#tab-1"    class="translate active">General</a></li>
                        <li class="tab col s2"><a href="#tab-2" class="translate">Gruppen</a></li>
                        <li class="tab col s2"><a href="#tab-3" class="translate">JSON</a></li>
                    </ul>
                </div>

                <div id="tab-1"    class="col s12 page">
                    <div class="row">
                        <div class="col s12">
                            <h6 class="translate sub-title">general configuration</h6>
                        </div>
                        <div class="col s6">
                            <input class="value" id="elcostt" />
                            <label for="elcost" class="translate">elcost</label>
                            <p>€/kWh</p>
                            </td>
                            <!-- Important: label must come directly after input. Label is important. -->
                        </div>
                        <div class="col s6">
                            <input class="value" id="gascost" />
                            <label for="gascost" class="translate">gascost</label>
                            <p>€/m³</p>
                            <!-- Important: label must come directly after input. Label is important. -->
                        </div>
                    </div>
                </div>
                <div id="tab-2"    class="col s12 page">
                    <div class="row">
                        <div class="col s12">
                            <h6 class="translate sub-title">sum group configuration</h6>
                        </div>
                    </div>
                    <div class="col s12" id="values">
                        <div class="row">
                            <div class="col s2 m1 l1 center">
                                <button title="Add device" class="table-button-add btn-floating waves-effect waves-light btn-small">
                                    <i class=" material-icons">add</i>
                                </button>
                            </div>
                        </div>
                        <div class="col s12 m12 l12">
                            <table class="table-values" style="width: 90%;">
                                <thead>
                                    <tr>
                                        <th data-name="_index"   style="width: 40px" class="translate"></th>
                                        <th data-name="groupid"    style="width: 150px"class="translate">Gruppe</th>
                                        <th data-name="groupname"    style="width: 200px"  class="translate">Gruppenname</th>
                                        <th data-name="groupcost"     style="width: 200px" class="translate">Kosten</th>
                                        <th data-name="groupcostunit"     style="width: 200px" class="translate">Einheit</th>
                                        <th data-buttons="delete" style="width: 40px"></th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
                <div id="tab-3"    class="col s12 page">
                    <div class="row">
                        <div class="col s12">
                            <h6 class="translate sub-title">import/export</h6>
                        </div>
                        <div class="col s6">
                            <button style="display: inline-block; margin-left: 10px;">Import</button>
                        </div>
                        <div class="col s6">
                                <button style="display: inline-block; margin-left: 10px;">Export</button>
                        </div>
                    </div>
                </div>    

            </div>
        </div>
    </body>
    
</html>
